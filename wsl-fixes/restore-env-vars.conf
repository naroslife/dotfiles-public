#!/usr/bin/env bash
#
# Environment Variables Restoration Configuration
#
# This file contains all environment variables that were removed from the
# Electron AppImage launchers to fix slow startup issues.
#
# USAGE:
# 1. Uncomment any variables you want to restore (remove the leading #)
# 2. Source this file or use it with the launcher script
# 3. Test if the app still opens quickly
#
# NOTE: Adding more than ~10-15 of these variables may cause slow startup again.
# See wsl-fixes/ELECTRON_ENV_INVESTIGATION.md for details.
#
# BASE VARIABLES (always included in launcher):
# These are always included with their values shown below.
# You can override them by uncommenting the ORIGINAL_ versions below.
#
# Current launcher values:
#   HOME=$HOME
#   USER=$USER
#   SHELL=$SHELL
#   DISPLAY=:0
#   DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus
#   XDG_RUNTIME_DIR=/run/user/1000
#   LIBVA_DRIVER_NAME=none
#   GDK_BACKEND=x11
#   PATH=/usr/local/bin:/usr/bin:/bin (SIMPLIFIED - see below for original)
#

# === ORIGINAL VALUES OF SIMPLIFIED VARIABLES ===
# The launchers simplified these variables for performance.
# Uncomment to restore the original full values.

# Original PATH (910 bytes with Nix, CUDA, npm, cargo, vscode-server, etc.)
# WARNING: This long PATH was one of the suspected culprits in combination with other vars
PATH=/home/enterpriseuser/.local/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/home/enterpriseuser/.cargo/bin:/home/enterpriseuser/.npm-global/bin:./node_modules/.bin:/home/enterpriseuser/.vscode-server/bin/e3a5acfb517a443235981655413d566533107e92/bin/remote-cli:/home/enterpriseuser/.config/carapace/bin:/home/enterpriseuser/.local/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/home/enterpriseuser/.cargo/bin:/home/enterpriseuser/.npm-global/bin:./node_modules/.bin:/home/enterpriseuser/.nix-profile/bin:/nix/var/nix/profiles/default/bin:/home/enterpriseuser/bin:/home/enterpriseuser/go/bin:/home/enterpriseuser/.gem/bin:/home/enterpriseuser/.dotnet/tools:/nix/store/vhlpl479762ar0102ih4b88371h6gypp-python3.13-poetry-2.2.1/bin:/usr/local/cuda/bin:/usr/local/sbin:/usr/games:/usr/local/games:/usr/lib/wsl/lib:/home/enterpriseuser/.zsh/plugins/fzf-tab:/mnt/c/Windows/System32:/home/enterpriseuser/.vscode-server/data/User/globalStorage/github.copilot-chat/debugCommand:/mnt/c/Windows/System32

# Original LD_LIBRARY_PATH (if you had one set)
# This was completely removed in the launcher
# Add project-specific library paths as needed
#LD_LIBRARY_PATH=/usr/lib/wsl/lib:/usr/local/cuda/lib64:

#

# === Application/Tool History and Session IDs ===
# These are session-specific and usually don't need to be restored
#ATUIN_HISTORY_ID=01999a3dd92b78819efe2e1a3ecc0160
#ATUIN_SESSION=01999a3825277043bdb74f1b6fc61740

# === Tool Configurations ===
# bat (cat replacement)
#BAT_STYLE=numbers,changes,header
#BAT_THEME=Monokai Extended

# Browser integration
BROWSER=wslview

# Docker build settings
BUILDKIT_PROGRESS=plain
COMPOSE_DOCKER_CLI_BUILD=1
DOCKER_BUILDKIT=1

# Delta (git diff viewer)
DELTA_FEATURES=+side-by-side

# === Language Package Managers ===
# Ruby/Bundler
BUNDLE_USER_HOME=/home/enterpriseuser/.bundle
GEM_HOME=/home/enterpriseuser/.gem

# Rust/Cargo
CARGO_HOME=/home/enterpriseuser/.cargo

# Go
#GO111MODULE=on
GOBIN=/home/enterpriseuser/go/bin
GOPATH=/home/enterpriseuser/go

# Node.js
COREPACK_ENABLE_AUTO_PIN=0

# === CUDA/GPU (suspected but proven NOT the cause) ===
# These were initially suspected but are fast when tested alone
CUDA_HOME=/usr/local/cuda
CUDA_PATH=/usr/local/cuda
#LD_LIBRARY_PATH=/usr/local/cuda/lib64:/nix/store/...

# === Claude Code Environment ===
# If you're running from Claude Code, these might be useful
CLAUDE=true
CLAUDECODE=1
CLAUDE_CODE_ENTRYPOINT=cli
CLAUDE_CODE_SSE_PORT=12744

# === Terminal/Color Settings ===
COLORTERM=truecolor
EZA_COLORS=uu=33:gu=33:sn=32:sb=32:da=34:ur=33:uw=31:ux=32:ue=32:gr=33:gw=31:gx=32:tr=33:tw=31:tx=32
TERM=xterm-256color
TERM_PROGRAM=vscode
TERM_PROGRAM_VERSION=1.104.2

# === Dotfiles Configuration ===
DOTFILES=/home/enterpriseuser/dotfiles
DOTFILES_MANAGED=home-manager
DOTFILES_VERSION=2.0

# === Editor Settings ===
EDITOR=code
VISUAL=code
GIT_EDITOR=true
ENABLE_IDE_INTEGRATION=true

# === FZF (fuzzy finder) Configuration ===
# Multiple FZF variables - these might interact
FZF_ALT_C_OPTS=--preview 'tree -C {} | head -200'
FZF_CTRL_R_OPTS=--preview 'echo {}' --preview-window down:3:hidden:wrap --bind '?:toggle-preview'
FZF_CTRL_T_OPTS=--preview '(bat --color=always {} || tree -C {}) 2> /dev/null | head -200'
FZF_DEFAULT_COMMAND=fd --type f --hidden --follow
FZF_DEFAULT_OPTS=--height 40% --layout=reverse --border --info=inline

# === Git Integration ===
# Long VSCode path - might be problematic
GIT_ASKPASS=/home/enterpriseuser/.vscode-server/bin/e3a5acfb517a443235981655413d566533107e92/extensions/git/dist/askpass.sh
VSCODE_GIT_ASKPASS_MAIN=/home/enterpriseuser/.vscode-server/bin/e3a5acfb517a443235981655413d566533107e92/extensions/git/dist/askpass-main.js
VSCODE_GIT_ASKPASS_NODE=/home/enterpriseuser/.vscode-server/bin/e3a5acfb517a443235981655413d566533107e92/node
VSCODE_GIT_IPC_HANDLE=/run/user/1000/vscode-git-8f1a3b2e9c.sock

# === GPG/Security ===
GNUPGHOME=/home/enterpriseuser/.gnupg
GPG_TTY=not a tty
SSH_AUTH_SOCK=/run/user/1000/gnupg/S.gpg-agent.ssh

# === Shell History Configuration ===
HISTCONTROL=ignoreboth:erasedups
HISTFILE=/home/enterpriseuser/.cache/zsh/history
HISTFILESIZE=100000
HISTSIZE=50000
SAVEHIST=50000

# === Java ===
JAVA_HOME=/nix/store/pkhdb9invwiad9c8qvbzhkyvl4yblwd6-openjdk-17.0.16+8/lib/openjdk

# === Less (pager) Configuration ===
LESS=-FRXi
LESSCHARSET=utf-8
LESSHISTFILE=/home/enterpriseuser/.cache/less/history
LESS_TERMCAP_mb=$'\E[1;31m'
LESS_TERMCAP_md=$'\E[1;36m'
LESS_TERMCAP_me=$'\E[0m'
LESS_TERMCAP_se=$'\E[0m'
LESS_TERMCAP_so=$'\E[01;44;33m'
LESS_TERMCAP_ue=$'\E[0m'
LESS_TERMCAP_us=$'\E[1;32m'

# === Locale Settings ===
# Nix-specific locale archive
LOCALE_ARCHIVE=/usr/lib/locale/locale-archive
LOCALE_ARCHIVE_2_27=/nix/store/k4xm73cjv0yv89jbsgq9gjjkq9d01b72-glibc-locales-2.39-52/lib/locale/locale-archive
LANG=en_US.UTF-8
LC_ALL=en_US.UTF-8

# === Nix/Home Manager ===
# These are essential for Nix but not for Electron apps
NIX_PATH=nixpkgs=/nix/var/nix/profiles/per-user/root/channels/nixpkgs:/nix/var/nix/profiles/per-user/root/channels
NIX_PROFILES=/nix/var/nix/profiles/default /home/enterpriseuser/.nix-profile
NIX_SSL_CERT_FILE=/etc/ssl/certs/ca-certificates.crt
NIXPKGS_ALLOW_UNFREE=1
__ETC_PROFILE_NIX_SOURCED=1
__HM_SESS_VARS_SOURCED=1

# === Python ===
PYTHONUNBUFFERED=1
PYTHONIOENCODING=utf-8

# === Package Config ===
PKG_CONFIG_PATH=/usr/lib/x86_64-linux-gnu/pkgconfig:/usr/share/pkgconfig:/usr/lib/pkgconfig

# === VSCode Server ===
# VSCODE_AMD_ENTRYPOINT=vs/workbench/api/node/extensionHostProcess
# VSCODE_HANDLES_UNCAUGHT_ERRORS=true
# VSCODE_IPC_HOOK_CLI=/run/user/1000/vscode-ipc-12345.sock

# === WSL Specific ===
WSL_DISTRO_NAME=xde-22
WSL_INTEROP=/run/WSL/12345_interop
WSL2_GUI_APPS_ENABLED=1
WSLENV=ELECTRON_RUN_AS_NODE/w:

# === XDG Directories ===
# Most of these should already be handled by XDG_RUNTIME_DIR
XDG_CACHE_HOME=/home/enterpriseuser/.cache
XDG_CONFIG_DIRS=/etc/xdg
XDG_CONFIG_HOME=/home/enterpriseuser/.config
XDG_DATA_DIRS=/usr/local/share:/usr/share:/var/lib/snapd/desktop
XDG_DATA_HOME=/home/enterpriseuser/.local/share
XDG_STATE_HOME=/home/enterpriseuser/.local/state

# === Zsh Specific ===
ZDOTDIR=/home/enterpriseuser
USER_ZDOTDIR=/home/enterpriseuser

# === Miscellaneous ===
PAGER=less
MANPAGER=less
SYSTEMD_PAGER=
DOTNET_CLI_TELEMETRY_OPTOUT=1
POWERSHELL_TELEMETRY_OPTOUT=1

#
# END OF CONFIGURATION
#
# To use these variables with the launcher, you can either:
# 1. Edit the launcher script directly and add the uncommented variables
# 2. Source this file before running: source /tmp/restore-env-vars.conf && launch-next-client.sh
# 3. Create a wrapper script that sources this file and then calls the launcher
#
